import{_,o as u,c as r,a as o,w as F,d as m,v as D,F as h,r as y,t as a,e as v,f as V,b as g,p as C,g as b,n as I,h as U,i as p,C as k,j as c,k as w,L as T}from"./index-c0eac731.js";const A={props:{document:{type:Object,required:!0},guids:{type:Array,required:!0},documents:{type:Array,required:!0},folders:{type:Array},folder:{type:String,default:""}},data(){return{show:!1,editedDocument:{}}},mounted(){this.editedDocument.folder=this.document.folder},watch:{"editedDocument.guid":{immediate:!0,handler(t){const e=this.documents.find(d=>d.guid===t);e&&(this.editedDocument.title=e.title,this.editedDocument.content=e.content,this.editedDocument.tags=e.tags,this.editedDocument.version=e.version,this.editedDocument.folder=e.folder)}}},methods:{open(){this.editedDocument={...this.document},this.show=!0},close(){this.show=!1},closeOnOverlayClick(t){t.target===t.currentTarget&&this.close()},cancel(){this.close()},submit(){this.$emit("document-updated",{...this.editedDocument}),this.close()},async updateContent(){const t=this.documents.find(e=>e.guid===this.editedDocument.guid);t&&(this.editedDocument.content=t.content)}}},f=t=>(C("data-v-e31dfccc"),t=t(),b(),t),E={class:"edit-dialog"},O=f(()=>o("h2",null,"Edit Document",-1)),M=f(()=>o("label",{for:"guid"},"GUID:",-1)),B=["value"],N=f(()=>o("label",{for:"title"},"Title:",-1)),j=f(()=>o("label",{for:"content"},"Content:",-1)),q=f(()=>o("label",{for:"tags"},"Tags:",-1)),L={for:"version"},W={for:"folder"},z=["value"],H={class:"edit-dialog-actions"},J=f(()=>o("button",{type:"submit"},"Save",-1));function K(t,e,d,s,l,i){return l.show?(u(),r("div",{key:0,class:"edit-dialog-overlay",onClick:e[8]||(e[8]=n=>i.closeOnOverlayClick(n))},[o("div",E,[O,o("form",{onSubmit:e[7]||(e[7]=F((...n)=>i.submit&&i.submit(...n),["prevent"]))},[M,m(o("select",{id:"guid","onUpdate:modelValue":e[0]||(e[0]=n=>l.editedDocument.guid=n),class:"custom-select",onChange:e[1]||(e[1]=(...n)=>i.updateContent&&i.updateContent(...n))},[(u(!0),r(h,null,y(d.guids,n=>(u(),r("option",{key:n,value:n},a(n),9,B))),128))],544),[[D,l.editedDocument.guid]]),N,m(o("input",{type:"text",id:"title","onUpdate:modelValue":e[2]||(e[2]=n=>l.editedDocument.title=n)},null,512),[[v,l.editedDocument.title]]),j,m(o("textarea",{id:"content","onUpdate:modelValue":e[3]||(e[3]=n=>l.editedDocument.content=n)},null,512),[[v,l.editedDocument.content]]),q,m(o("input",{type:"text",id:"tags","onUpdate:modelValue":e[4]||(e[4]=n=>l.editedDocument.tags=n)},null,512),[[v,l.editedDocument.tags]]),o("p",null,[o("label",L,[V("Version: "),o("span",null,"v."+a(l.editedDocument.version),1)])]),o("label",W,"Folder: "+a(d.folder),1),m(o("select",{id:"folder","onUpdate:modelValue":e[5]||(e[5]=n=>l.editedDocument.folder=n),class:"custom-select"},[(u(!0),r(h,null,y(d.folders,n=>(u(),r("option",{key:n,value:n},a(n.name),9,z))),128))],512),[[D,l.editedDocument.folder]]),o("div",H,[o("button",{type:"button",onClick:e[6]||(e[6]=(...n)=>i.cancel&&i.cancel(...n))},"Cancel"),J])],32)])])):g("",!0)}const $=_(A,[["render",K],["__scopeId","data-v-e31dfccc"]]);const G=t=>(C("data-v-52b07391"),t=t(),b(),t),P={class:"document-container"},Q={class:"document"},R=["title"],X=["title"],Y=G(()=>o("i",{class:"fa-solid fa-tag tag-icon"},null,-1)),Z={key:0,class:"tag-list"},x=["title"],ee=G(()=>o("div",{class:"actions"},[o("span",{class:"loadContent"},[o("i",{class:"fa-solid fa-file"})])],-1)),te={class:"documentContent"},oe={class:"document-actions"},ne={props:{document:{type:Object,required:!0},documents:{type:Array,required:!0}},data(){return{loading:!1,loadedDocument:null,hover:!1,showContent:!1,guids:[],folders:[]}},components:{ConfirmDialog:k,EditDocumentDialog:$},created(){this.fetchFolders()},methods:{getFolderNameByDocumentGuid(t){const e=this.folders.find(d=>d.documents.some(s=>s.guid===t));return e?e.name:""},async fetchFolders(){try{this.folders=(await c.get("/folders")).data}catch{alert("Error fetching folders")}},async loadContent(t){if(!this.loading)try{this.loading=!0,this.loadedDocument=(await c.get(`folders/${this.folderGuid}/${t}`)).data,this.showContent=!this.showContent}catch{}finally{this.loading=!1}},getDocument(t){return this.loadedDocument&&this.loadedDocument.guid===t?this.loadedDocument.content:null},async confirmDelete(){if(await this.$refs.confirmDialog.open())try{await c.delete(`documents/${this.document.guid}`),this.$emit("document-deleted",this.document.guid)}catch{}},async editDocument(){this.$refs.editDialog.open()},async updateDocument(t){try{const e=await this.fetchTags(t.tags),d={guid:t.guid,title:t.title,content:t.content,type:t.type,tags:e,version:t.version+1},s=t.folder.documents.map(i=>i.title),l={guid:t.folder.guid,name:t.folder.name,DocumentTitles:s};s.push(t.title),await c.put(`documents/${t.guid}`,d),await c.put(`folders/${t.folder.guid}`,l),this.$emit("document-updated",d),this.fetchFolders()}catch{alert("Error updating the document")}},async fetchTags(t){try{let e=[];typeof t=="string"&&t.includes(",")?e=t.split(",").map(i=>i.trim()):e=Array.isArray(t)?t:[t];const d=await c.get("tags"),s=new Map(d.data.map(i=>[i.name,i.id]));return e.map(i=>({tagId:s.get(i)}))}catch(e){alert("Error fetching tags:",e)}},async fetchGuids(){if(!this.loading)try{const t=await c.get(`folders/${this.folderGuid}`);this.guids=t.data.documents.map(e=>e.guid)}catch{}finally{this.loading=!1}}},computed:{folderGuid(){return this.$route.params.id},versionStyle(){return this.document.tags.length>0?{}:{flexGrow:1}}},mounted(){this.fetchGuids()}},de=Object.assign(ne,{__name:"DocumentComponent",setup(t){return(e,d)=>(u(),r(h,null,[o("div",P,[o("div",Q,[o("div",{class:"documentsHeader",onClick:d[2]||(d[2]=s=>e.loadContent(t.document.guid))},[o("div",{class:"title",title:t.document.title},a(t.document.title),9,R),o("div",{class:"version",title:t.document.version,style:I(e.versionStyle)}," v."+a(t.document.version),13,X),t.document.tags.length>0&&!e.show?(u(),r("div",{key:0,class:"tags",onMouseover:d[0]||(d[0]=s=>e.hover=!0),onMouseleave:d[1]||(d[1]=s=>e.hover=!1)},[Y,e.hover?(u(),r("div",Z,[o("ul",null,[(u(!0),r(h,null,y(t.document.tags,s=>(u(),r("li",{key:s},a(s),1))),128))])])):g("",!0)],32)):g("",!0),o("div",{class:"type",title:t.document.type},"."+a(t.document.type),9,x),ee]),o("div",te,[m(o("div",null,a(e.getDocument(t.document.guid)),513),[[U,e.showContent]])])]),o("div",oe,[o("button",{class:"edit-button",onClick:d[3]||(d[3]=(...s)=>e.editDocument&&e.editDocument(...s))},"Edit"),o("button",{class:"delete-button",onClick:d[4]||(d[4]=(...s)=>e.confirmDelete&&e.confirmDelete(...s))},"Delete")])]),p(k,{ref:"confirmDialog",title:"Delete Document",message:"Are you sure you want to delete this document?"},null,512),p($,{ref:"editDialog",document:t.document,guids:e.guids,documents:t.documents,folders:e.folders,folder:e.getFolderNameByDocumentGuid(t.document.guid),onDocumentUpdated:e.updateDocument},null,8,["document","guids","documents","folders","folder","onDocumentUpdated"])],64))}}),S=_(de,[["__scopeId","data-v-52b07391"]]),se={class:"folderView"},ie={class:"folders"},le={key:0,class:"documents"},ue={components:{DocumentComponent:S},data(){return{folder:{},loading:!1}},methods:{async loadFolder(){this.loading=!0;try{this.folder=(await c.get(`folders/${this.folderGuid}`)).data}catch{}finally{this.loading=!1}}},async mounted(){this.loadFolder(),this.loading=!0},computed:{folderGuid(){return this.$route.params.id}}},ae=Object.assign(ue,{__name:"FolderView",setup(t){return(e,d)=>(u(),r("div",se,[e.loading?(u(),w(T,{key:0})):g("",!0),o("h1",null,a(e.folder.name),1),o("div",ie,[o("h4",null,"guid: "+a(e.folderGuid),1),e.folder.documents?(u(),r("div",le,[(u(!0),r(h,null,y(e.folder.documents,s=>(u(),w(S,{key:s.guid,document:s,documents:e.folder.documents,onDocumentDeleted:e.loadFolder,onDocumentUpdated:e.loadFolder},null,8,["document","documents","onDocumentDeleted","onDocumentUpdated"]))),128))])):g("",!0)])]))}});export{ae as default};
