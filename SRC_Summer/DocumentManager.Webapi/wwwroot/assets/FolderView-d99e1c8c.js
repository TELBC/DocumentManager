import{_ as b,o as l,c as a,a as o,w as G,d as h,v as I,F as y,r as v,t as r,e as f,b as g,p as w,f as _,n as V,g as E,h as p,C,i as c,j as D,L as O}from"./index-474ad142.js";const U={props:{document:{type:Object,required:!0},guids:{type:Array,required:!0},documents:{type:Array,required:!0}},data(){return{show:!1,editedDocument:{}}},watch:{"editedDocument.guid":{immediate:!0,handler(t){const e=this.documents.find(n=>n.guid===t);e&&(this.editedDocument.title=e.title,this.editedDocument.content=e.content,this.editedDocument.tags=e.tags,this.editedDocument.version=e.version)}}},methods:{open(){this.editedDocument={...this.document},this.show=!0},close(){this.show=!1},closeOnOverlayClick(t){t.target===t.currentTarget&&this.close()},cancel(){this.close()},submit(){this.$emit("document-updated",{...this.editedDocument}),this.close()},async updateContent(){const t=this.documents.find(e=>e.guid===this.editedDocument.guid);t&&(this.editedDocument.content=t.content)}}},m=t=>(w("data-v-b4d433be"),t=t(),_(),t),A={class:"edit-dialog"},M=m(()=>o("h2",null,"Edit Document",-1)),F=m(()=>o("label",{for:"guid"},"GUID:",-1)),T=["value"],j=m(()=>o("label",{for:"title"},"Title:",-1)),q=m(()=>o("label",{for:"content"},"Content:",-1)),B=m(()=>o("label",{for:"tags"},"Tags:",-1)),L=m(()=>o("label",{for:"version"},"Version:",-1)),N={class:"edit-dialog-actions"},R=m(()=>o("button",{type:"submit"},"Save",-1));function W(t,e,n,i,u,d){return u.show?(l(),a("div",{key:0,class:"edit-dialog-overlay",onClick:e[8]||(e[8]=s=>d.closeOnOverlayClick(s))},[o("div",A,[M,o("form",{onSubmit:e[7]||(e[7]=G((...s)=>d.submit&&d.submit(...s),["prevent"]))},[F,h(o("select",{id:"guid","onUpdate:modelValue":e[0]||(e[0]=s=>u.editedDocument.guid=s),class:"custom-select",onChange:e[1]||(e[1]=(...s)=>d.updateContent&&d.updateContent(...s))},[(l(!0),a(y,null,v(n.guids,s=>(l(),a("option",{key:s,value:s},r(s),9,T))),128))],544),[[I,u.editedDocument.guid]]),j,h(o("input",{type:"text",id:"title","onUpdate:modelValue":e[2]||(e[2]=s=>u.editedDocument.title=s)},null,512),[[f,u.editedDocument.title]]),q,h(o("textarea",{id:"content","onUpdate:modelValue":e[3]||(e[3]=s=>u.editedDocument.content=s)},null,512),[[f,u.editedDocument.content]]),B,h(o("input",{type:"text",id:"tags","onUpdate:modelValue":e[4]||(e[4]=s=>u.editedDocument.tags=s)},null,512),[[f,u.editedDocument.tags]]),L,h(o("input",{type:"text",id:"version","onUpdate:modelValue":e[5]||(e[5]=s=>u.editedDocument.version=s)},null,512),[[f,u.editedDocument.version]]),o("div",N,[o("button",{type:"button",onClick:e[6]||(e[6]=(...s)=>d.cancel&&d.cancel(...s))},"Cancel"),R])],32)])])):g("",!0)}const $=b(U,[["render",W],["__scopeId","data-v-b4d433be"]]);const k=t=>(w("data-v-b155756b"),t=t(),_(),t),z={class:"document-container"},H={class:"document"},J=["title"],K=["title"],P=k(()=>o("i",{class:"fa-solid fa-tag tag-icon"},null,-1)),Q={key:0,class:"tag-list"},X=["title"],Y=k(()=>o("div",{class:"actions"},[o("span",{class:"loadContent"},[o("i",{class:"fa-solid fa-file"})])],-1)),Z={class:"documentContent"},x={class:"document-actions"},ee={props:{document:{type:Object,required:!0},documents:{type:Array,required:!0}},data(){return{loading:!1,loadedDocument:null,hover:!1,showContent:!1,guids:[]}},components:{ConfirmDialog:C,EditDocumentDialog:$},methods:{async loadContent(t){if(!this.loading)try{this.loading=!0,this.loadedDocument=(await c.get(`folders/${this.folderGuid}/${t}`)).data,this.showContent=!this.showContent}catch{alert("Server was unable to load document.")}finally{this.loading=!1}},getDocument(t){return this.loadedDocument&&this.loadedDocument.guid===t?this.loadedDocument.content:null},async confirmDelete(){if(await this.$refs.confirmDialog.open())try{await c.delete(`documents/${this.document.guid}`),this.$emit("document-deleted",this.document.guid)}catch{alert("Error deleting the document")}},async editDocument(){this.$refs.editDialog.open()},async updateDocument(t){try{const e=await this.fetchTags(t.tags);console.log(e);const n={guid:t.guid,title:t.title,content:t.content,type:t.type,tags:e,version:t.version+1};console.log(n),await c.put(`documents/${t.guid}`,n),this.$emit("document-updated",n)}catch{alert("Error updating the document")}},async fetchTags(t){try{let e=[];typeof t=="string"&&t.includes(",")?e=t.split(",").map(d=>d.trim()):e=Array.isArray(t)?t:[t];const n=await c.get("tags"),i=new Map(n.data.map(d=>[d.name,d.id]));return e.map(d=>({tagId:i.get(d)}))}catch(e){console.error("Error fetching tags:",e)}},async fetchGuids(){if(!this.loading)try{const t=await c.get(`folders/${this.folderGuid}`);this.guids=t.data.documents.map(e=>e.guid)}catch{alert("ERROR fetching guids")}finally{this.loading=!1}}},computed:{folderGuid(){return this.$route.params.id},versionStyle(){return this.document.tags.length>0?{}:{flexGrow:1}}},mounted(){this.fetchGuids()}},te=Object.assign(ee,{__name:"DocumentComponent",setup(t){return(e,n)=>(l(),a(y,null,[o("div",z,[o("div",H,[o("div",{class:"documentsHeader",onClick:n[2]||(n[2]=i=>e.loadContent(t.document.guid))},[o("div",{class:"title",title:t.document.title},r(t.document.title),9,J),o("div",{class:"version",title:t.document.version,style:V(e.versionStyle)}," v."+r(t.document.version),13,K),t.document.tags.length>0&&!e.show?(l(),a("div",{key:0,class:"tags",onMouseover:n[0]||(n[0]=i=>e.hover=!0),onMouseleave:n[1]||(n[1]=i=>e.hover=!1)},[P,e.hover?(l(),a("div",Q,[o("ul",null,[(l(!0),a(y,null,v(t.document.tags,i=>(l(),a("li",{key:i},r(i),1))),128))])])):g("",!0)],32)):g("",!0),o("div",{class:"type",title:t.document.type},"."+r(t.document.type),9,X),Y]),o("div",Z,[h(o("div",null,r(e.getDocument(t.document.guid)),513),[[E,e.showContent]])])]),o("div",x,[o("button",{class:"edit-button",onClick:n[3]||(n[3]=(...i)=>e.editDocument&&e.editDocument(...i))},"Edit"),o("button",{class:"delete-button",onClick:n[4]||(n[4]=(...i)=>e.confirmDelete&&e.confirmDelete(...i))},"Delete")])]),p(C,{ref:"confirmDialog",title:"Delete Document",message:"Are you sure you want to delete this document?"},null,512),p($,{ref:"editDialog",document:t.document,documents:t.documents,guids:e.guids,onDocumentUpdated:e.updateDocument},null,8,["document","documents","guids","onDocumentUpdated"])],64))}}),S=b(te,[["__scopeId","data-v-b155756b"]]),oe={class:"folderView"},ne={class:"folders"},se={key:0,class:"documents"},ie={components:{DocumentComponent:S},data(){return{folder:{},loading:!1}},methods:{async loadFolder(){this.loading=!0;try{this.folder=(await c.get(`folders/${this.folderGuid}`)).data}catch{alert("Server was unable to load folder.")}finally{this.loading=!1}}},async mounted(){this.loadFolder(),this.loading=!0;try{this.folder=(await c.get(`folders/${this.folderGuid}`)).data}catch{alert("Server was unable to load folder.")}finally{this.loading=!1}},computed:{folderGuid(){return this.$route.params.id}}},le=Object.assign(ie,{__name:"FolderView",setup(t){return(e,n)=>(l(),a("div",oe,[e.loading?(l(),D(O,{key:0})):g("",!0),o("h1",null,r(e.folder.name),1),o("div",ne,[o("h4",null,"guid: "+r(e.folderGuid),1),e.folder.documents?(l(),a("div",se,[(l(!0),a(y,null,v(e.folder.documents,i=>(l(),D(S,{key:i.guid,document:i,documents:e.folder.documents,onDocumentDeleted:e.loadFolder},null,8,["document","documents","onDocumentDeleted"]))),128))])):g("",!0)])]))}});export{le as default};
